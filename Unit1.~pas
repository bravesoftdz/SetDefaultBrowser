unit Unit1;

interface

uses
  Windows, Messages, SysUtils, Variants, Classes, Graphics, Controls, Forms,
  Dialogs, Registry, StdCtrls;

type
  TForm1 = class(TForm)
    Button1: TButton;
    Edit1: TEdit;
    Edit2: TEdit;
    Button2: TButton;
    procedure Button1Click(Sender: TObject);
    procedure Button2Click(Sender: TObject);
  private
    function SetDefaultBrowser_Win7(GTBPath: String): Boolean;
    function SetDefaultBrowser_XP(GTBPath: String; GTBName: String): Boolean;
    { Private declarations }
  public
    { Public declarations }
  end;

var
  Form1: TForm1;

implementation

{$R *.dfm}

procedure TForm1.Button1Click(Sender: TObject);
begin
  SetDefaultBrowser_XP(Edit1.Text, Edit2.Text);
end;

//******************************************************************************
// …Ë÷√ƒ¨»œ‰Ø¿¿∆˜ for win7
//******************************************************************************
function TForm1.SetDefaultBrowser_Win7(GTBPath: String): Boolean;
var
  reg: TRegistry;
begin
  Result := False;
  reg := TRegistry.Create;
  try
    reg.RootKey := HKEY_CLASSES_ROOT;
    if reg.OpenKey('GTBrowser\shell\open\command', True) then
    begin
      reg.WriteString('', GTBPath);
    end;
    reg.CloseKey;

    reg.RootKey := HKEY_CURRENT_USER;
    if reg.OpenKey('Software\Microsoft\Windows\Shell\Associations\UrlAssociations\http\UserChoice', True) then
    begin
      reg.WriteString('Progid', 'GTBrowser');
    end;
    Result := True;
  finally
    reg.Free;
  end;
end;

//******************************************************************************
// …Ë÷√ƒ¨»œ‰Ø¿¿∆˜ for XP
//******************************************************************************
function TForm1.SetDefaultBrowser_XP(GTBPath: String; GTBName: String): Boolean;
var
  reg: TRegistry;
begin
  Result := False;
  reg := TRegistry.Create;
  try
    reg.RootKey := HKEY_CLASSES_ROOT;

    if Not reg.OpenKey('http\shell\open\command', True) then Exit;
    reg.WriteString('', GTBPath);
    reg.CloseKey;

    if Not reg.OpenKey('http\shell\open\ddeexec\Application', True) then Exit;
    reg.WriteString('', 'GTBrowser');
    reg.CloseKey;
    Result := True;
  finally
    reg.Free;
  end;
end;

procedure TForm1.Button2Click(Sender: TObject);
begin
  SetDefaultBrowser_Win7(Edit1.Text);
end;

end.
